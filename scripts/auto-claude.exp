#!/usr/bin/expect -f

# Claude ìë™ ìŠ¹ì¸ expect ìŠ¤í¬ë¦½íŠ¸
set timeout 120
set task [lindex $argv 0]

puts "ğŸš€ Running Claude with task: $task"

# Claude ì‹¤í–‰ (non-interactive ëª¨ë“œë¡œ)
spawn bash -c "echo '$task' | claude"

# ì²˜ìŒ 30ì´ˆëŠ” ëŒ€ê¸° (Claudeê°€ ì‘ì—… ì²˜ë¦¬í•˜ë„ë¡)
sleep 30

# ì´í›„ ê¶Œí•œ ìš”ì²­ íŒ¨í„´ ê°ì§€ ë° ìë™ ì‘ë‹µ
while {1} {
    expect {
        -timeout 5
        -re "permission|Would you like|proceed|Press Enter to|continue\\?" {
            puts "\nâœ… Auto-approving permission request..."
            sleep 1
            send "\r"
            exp_continue
        }
        -re "Write|Create|Edit|Delete" {
            # íŒŒì¼ ì‘ì—… ê¶Œí•œ ìš”ì²­
            puts "\nâœ… Auto-approving file operation..."
            sleep 1
            send "\r"
            exp_continue
        }
        -re "\\?" {
            # ì§ˆë¬¸ ê°ì§€ (ê¶Œí•œ ìš”ì²­ì¼ ê°€ëŠ¥ì„±)
            puts "\nâš ï¸ Question detected, sending Enter..."
            sleep 2
            send "\r"
            exp_continue
        }
        eof {
            puts "\nâœ… Claude completed"
            break
        }
        timeout {
            # 5ì´ˆ ë™ì•ˆ ì•„ë¬´ ì¶œë ¥ì´ ì—†ìœ¼ë©´ ì—”í„° ì…ë ¥
            puts "\nâ³ No output for 5 seconds, sending Enter..."
            send "\r"
        }
    }
}

wait